(()=>{"use strict";const t=class{constructor(t,e,n){this._pathname=t,this._blockClass=e,this._block=e,this._props=n}navigate(t){this.match(t)&&(this._pathname=t,this.render())}leave(){const t=document.querySelector(this._props.rootQuery);for(;t.firstChild;)t.removeChild(t.firstChild)}match(t){return t===this._pathname}render(){const t=document.querySelector(this._props.rootQuery);new this._blockClass(t).init(t),window.createValidateEvents()}};class e{constructor(t=""){if(this.routes=[],this.history=window.history,this._currentRoute=null,this._rootQuery="",e.__instance)return e.__instance;this.routes=[],this.history=window.history,this._currentRoute=null,this._rootQuery=t,e.__instance=this}use(e,n){const s=new t(e,n,{rootQuery:this._rootQuery});return this.routes.push(s),this}start(){return window.addEventListener("popstate",(t=>{this._onRoute(t.currentTarget.location.pathname)}).bind(this)),this}renderPage(t){this._onRoute(t)}_onRoute(t){const e=this.getRoute(t);e?(this._currentRoute&&this._currentRoute.leave(),this._currentRoute=e,e.render()):console.error("Route not found:"+t)}go(t){this.history.pushState({},"",t),this._onRoute(t)}back(){this.history.back()}forward(){window.history.forward()}getRoute(t){return this.routes.find((e=>e.match(t)))}}const n=class{constructor(){this.listeners={}}on(t,e){this.listeners[t]||(this.listeners[t]=Array()),this.listeners[t].push(e)}off(t,e){if(!this.listeners[t])throw new Error(`Нет события: ${t}`);this.listeners[t]=this.listeners[t].filter((t=>t!==e))}emit(t,...e){if(!this.listeners[t])throw new Error(`Нет события: ${t}`);this.listeners[t].forEach((function(t){t(...e)}))}};var s;function a(t){return function(t){const e=Array();t=(t=t.replace(/{%/g,"<{%")).replace(/%}/g,"%}>");const n=(t,n)=>{const a=t===s.BEGIN?window.uid():0;e.push({type:t,content:n,uid:a,deleteMark:!1})};t=t.split(/\n/g).reduce((function(t,e){return e.replace(/\s/g,"").startsWith("//")?t:t+"\n"+e}),"").trim();for(;t;){const e=t.indexOf("<");let a=t.indexOf(">");const i=t.startsWith("<{%");a=i?t.indexOf("%}>")+2:a;let o=t.slice(e+1,a).trim().replace(/[\r\n]+/g,"");const r=o.startsWith("/");if(i?n(s.CODE,o):n(r?s.END:s.BEGIN,r?o.slice(1):o),(t=t.slice(a+1).trim()).indexOf("<")>=0){const e=t.substring(0,t.indexOf("<"));e&&n(s.TEXT,e),t=t.slice(t.indexOf("<")).trim()}}return e}(t)}!function(t){t[t.BEGIN=0]="BEGIN",t[t.END=1]="END",t[t.TEXT=2]="TEXT",t[t.CODE=3]="CODE"}(s||(s={}));const i=/\{\{(.*?)\}\}/gi;class o{constructor(){this._isNew=!0,this._changedProps=[],this._deleteMark=!1,this.uid=0,this.key="",this.textContent="",this.textContentIsChanged=!1,this.level=0,this.parent=null,this.header="",this.tagName="",this.isComponent=!1,this.props={},this.componentLink=null,this.root=null,this.element=null}get isNew(){return this._isNew}set isNew(t){this._isNew=t}get changedProps(){return this._changedProps}set changedProps(t){this._changedProps=t}get deleteMark(){return this._deleteMark}set deleteMark(t){this._deleteMark=t}setContentProps(t,e){const n=this.textContent;let{content:s}=e.record;s||(this.textContent=s,this.textContentIsChanged=!1),window.regexpMatchAll(s,i).forEach((function(e){e[1]&&(s=s.replace(e[0],window.get(t,e[1],"")))})),this.textContent=s,this.textContentIsChanged=n!==s}setChangedProps(t,e=null){const n=[];if(e)for(const s in t)window.isEqual(e[s],t[s])||n.push(s);else for(const e in t)n.push(e);this.changedProps=n}setSignComponent(){this.isComponent=window.startsWithUpper(this.tagName)}setLevel(){window.get(this,"owner.level",-1);this.level}}class r{constructor(){this._nodes=Array(),this._parent=this._func_parent(),this._REGEXP_PARAM=/\{\{(.*?)\}\}/gi,this._deleteMark=!1}get deleteMark(){return this._deleteMark}set deleteMark(t){this._deleteMark=t}compile(t,e,n,s){this.deleteMark=s,this._setNodesDeleteMark(),this._compileTemplate(t,e,n)}_compileTemplate(t,e,n){const a={state:e,props:n},i={list:t,record:null,i:(0,0)};for(;i.i<i.list.length;i.i++)i.record=i.list[i.i],i.record.type===s.CODE?this._compileCode(a,i):this._compileItem(a,i)}_compileItem(t,e){switch(e.record.type){case s.END:this._closeTag();break;case s.TEXT:case s.BEGIN:this._compileItem_process(t,e);break;default:throw new Error(`Tree: error initializing the tree for: ${e.record.type} ${e.record.content}`)}}_compileItem_process(t,e){const{record:n}=e;if(n.type===s.BEGIN){const s=this._getTagName(n.content),a=this._getHeaderProps(t,e,s);let i=this.getNodeByUidKey(n.uid,a.key);if(i)i.setChangedProps(a,i.props),i.tagName=s,i.props=a,i.deleteMark=this.deleteMark||n.deleteMark;else{if(this.deleteMark||n.deleteMark)return;i=new o,this._nodes.push(i),i.tagName=s,i.props=a,i.header=n.content,i.uid=n.uid,i.key=a.key?a.key:"",i.setLevel(),i.setSignComponent(),i.setChangedProps(i.props)}i.parent=this._parent("add",i)}else if(n.type===s.TEXT){let n=this._parent("",null);n&&!n.isComponent&&n.setContentProps(t,e)}}_compileCode(t,e){this._compileCode__cycle_for(t,e),this._compileCode__if(t,e)}_compileCode__cycle_for(t,e){let n=e.record.content.slice(2,e.record.content.indexOf("%}")).trim();if(!n.startsWith("for"))return;const a=n.substring(n.indexOf("(")+1,n.indexOf(")")).trim().split(";"),i=a[0].trim().split(" ").filter((t=>t)),o=i[1];t[o]=Number(i[3]);const r=a[1].trim().split(" ").filter((t=>t)),l=r[1],c=window.get(t,r[2],0);let h=a[2].trim().replace(i[1],"");const d=n.substring(n.indexOf("{")+1).trim().split(";").filter((t=>t)).map((t=>t.trim())),u=[];if(d.forEach((function(t){(t.startsWith("let")||t.startsWith("const"))&&u.push(t.substring(t.indexOf(" ")).replace(/ /gi,"").split("="))})),!this._compare(t[o],l,c)){for(;!this._code__isCloseBracket(e)&&e.i<e.list.length;)e.i++,e.record=e.list[e.i];return e.i++,e.record=e.list[e.i],void this._compileItem(t,e)}const p=e.i;for(t[o];this._compare(t[o],l,c);t[o]=t[o]+this._inc(h)){u.forEach((function(e){const n=/\[(.)\]/gm.exec(e[1]);t[e[0]]=window.get(t,e[1].substring(0,null==n?void 0:n.index))[t[n[1]]]})),e.i=p,e.i++;let n=null;for(e.i;e.i<e.list.length;e.i++){const a=Object.assign({},e.list[e.i]);if(e.record=a,a.type===s.CODE){if(this._code__isCloseBracket(e)){e.i++,e.record=Object.assign({},e.list[e.i]);break}this._compileCode(t,e)}if(window.regexpMatchAll(a.content,this._REGEXP_PARAM).forEach((function(e){u.forEach((function(n){e[1]&&e[1].startsWith(n[0])&&(t.state[n[0]]=t[n[0]],a.content=a.content.replace(e[0],"{{state."+e[1]+"}}"))}))})),a.type===s.BEGIN){const e=a.content.indexOf("key");if(e>0){const s=new RegExp(this._REGEXP_PARAM).exec(a.content.substring(e));n=window.get(t,s[1],s[1]),a.content=a.content.replace(new RegExp(s[0],"g"),n)}else a.content+=" key="+n}this._compileItem(t,e)}}}_compileCode__if(t,e){let n=e.record.content.slice(2,e.record.content.indexOf("%}")).trim();if(!n.startsWith("if"))return;let a=!0;const i=n.substring(n.indexOf("(")+1,n.indexOf(")")).trim().split(" ").filter((t=>t)),o=this._code__calculateValue(t,i[0]);if(i[2]){const e=this._code__calculateValue(t,i[2]);a=this._compare(o,i[1],e)}else a=o;for(e.i++,e.i;e.i<e.list.length;e.i++){const n=e.list[e.i];if(e.record=n,n.type===s.CODE){if("{%}else{%}"===e.record.content.replace(/ /gi,"")){a=!a;continue}if(this._code__isCloseBracket(e))break;if(!a){for(;!this._code__isCloseBracket(e)&&e.i<e.list.length;)e.i++,e.record=e.list[e.i];continue}this._compileCode(t,e)}n.deleteMark=!a,a&&this._compileItem(t,e)}}_code__isCloseBracket(t){return"{%}%}"===t.record.content.replace(/ /gi,"")}_code__calculateValue(t,e){if("null"===e)return null;let n;const s=new RegExp(this._REGEXP_PARAM).exec(e);return n=s?window.get(t,s[1],s[1]):e,n&&window.regexpMatchAll(n,/[\'\"](.*?)[\'\"]/gi).forEach((t=>{n=t[1]})),n}_getHeaderProps(t,e,n){let{content:s}=e.record;const a={},i={};let o=1;return window.regexpMatchAll(s,/[\'\"](.*?)[\'\"]/gi).forEach((function(t){t[0]&&(i[`text${o}`]=t[0],s=s.replace(t[0],`text${o}`),o++)})),s.split(" ").forEach((e=>{if(!e||e===n)return;const s=e.split("=");i[s[1]]&&s.length>1&&(s[1]=i[s[1]]);const o=new RegExp(this._REGEXP_PARAM).exec(s[1]);if("className"===s[0]){const e=o?window.get(t,o[1],""):s[1].replace(/[\'\"]/g,"").trim();e&&(a.classes=e.split(" "))}else 1===s.length?a[s[0]]="#noValue":a[s[0]]=o?window.get(t,o[1],o[1]):s[1].replace(/[\'\"]/g,"")})),a}_compare(t,e,n){switch(e){case"<":return t<n;case"<=":return t<=n;case">":return t>n;case">=":return t>=n;case"===":return t===n;case"!==":return t!==n;default:throw new Error("Compare error")}}_inc(t){switch(t){case"++":return 1;case"--":return-1;default:throw new Error("Step error")}}_closeTag(){this._parent("remove",null)}_func_parent(){const t=Array();return function(e="",n=null){let s=null;return"remove"===e?t.pop():t.length>0&&(s=t[t.length-1]),"add"===e&&t.push(n),s}}_setNodesDeleteMark(){this._nodes.forEach((function(t){t.deleteMark=!0}))}_getTagName(t){const e=-1===t.indexOf(" ")?t.length:t.indexOf(" ");return t.slice(0,e)}getIsComponent(){return this._nodes.filter((t=>!0===t.isComponent))}getNodes(){return this._nodes}getNodeByUidKey(t,e){for(let n=0;n<this._nodes.length;n++){let s=this._nodes[n];if(!e&&s.uid===t||e&&s.key===e&&s.uid===t)return s}return null}deleteMarkedNodes(){this._nodes.forEach((t=>{var e;t.isComponent&&t.componentLink&&(null===(e=t.componentLink.virtDOM)||void 0===e||e.deleteMarkedNodes()),this._nodes=this._nodes.filter((t=>!t.deleteMark))}))}printNodes(){console.log("////////////////////////////////////////////////"),this._nodes.forEach((function(t){console.log(t.deleteMark,t)}))}}function l(t){t.preventDefault(),t.stopPropagation();let n=null;for(let e=0;e<t.path.length;e++){if(n=t.path[e].getAttribute("href"),n&&n.startsWith("#{R}"))break}if(!n)return void console.error("Route not found");(new e).go(`${null==n?void 0:n.slice(4)}`)}var c;window.addEventListener("hashchange",(function(t){if(""===window.location.hash)window.history.back();else{(new e).renderPage(window.location.hash)}}),!1),function(t){t.FLOW_CDM="flow:component-did-mount",t.FLOW_CDU="flow:component-did-update",t.FLOW_CWU="flow:component-will-update",t.FLOW_CWM="flow:component-will-mount",t.FLOW_EXECUTE="flow:execute",t.FLOW_COMPILE="flow:compile",t.FLOW_RENDER="flow:render"}(c||(c={}));const h=class{constructor(t={}){this._root=null,this._virtDOM=null,this._props=null,this._rootOut=null,this._parsedTemplate=null,this._deleteMark=!1,this._isNew=!0,this._componentDidMountExecuted=!1,this.state={},this._root=null;const e=new n;this._props=t,this.eventBus=()=>e,this._registerEvents(e)}get rootOut(){return this._rootOut}get deleteMark(){return this._deleteMark}set deleteMark(t){this._deleteMark=t}get parsedTemplate(){return this._parsedTemplate}set parsedTemplate(t){this._parsedTemplate=t}get virtDOM(){return this._virtDOM}getProps(){return this._props}setProps(t){this._props=t}components(){return{}}template(){return""}_registerEvents(t){t.on(c.FLOW_CDM,this._componentDidMount.bind(this)),t.on(c.FLOW_CDU,this._componentDidUpdate.bind(this)),t.on(c.FLOW_CWU,this._componentWillUpdate.bind(this)),t.on(c.FLOW_CWM,this._componentWillMount.bind(this)),t.on(c.FLOW_EXECUTE,this._execute.bind(this)),t.on(c.FLOW_COMPILE,this._compile.bind(this)),t.on(c.FLOW_RENDER,this._render.bind(this))}init(t){this._root=t,this._isNew?this.eventBus().emit(c.FLOW_CWM,this.getProps(),this.getProps()):this.eventBus().emit(c.FLOW_CWU,this.getProps(),this.state),this.eventBus().emit(c.FLOW_EXECUTE),this._isNew?this.eventBus().emit(c.FLOW_CDM,this.getProps(),this.state):this.eventBus().emit(c.FLOW_CDU,this.getProps(),this.getProps()),this._isNew=!1}_componentDidMount(t=null,e=null){this.componentDidMount(t,e)}componentDidMount(t=null,e=null){}_componentDidUpdate(t=null,e=null){this.componentDidUpdate(t,e)}componentDidUpdate(t=null,e=null){}_componentWillUpdate(t=null,e=null){this.componentWillUpdate(t,e)}componentWillUpdate(t=null,e=null){}_componentWillMount(t=null,e=null){this.componentWillMount(t,e)}componentWillMount(t=null,e=null){}_execute(t={}){this.execute(t),this.eventBus().emit(c.FLOW_COMPILE,t)}execute(t={}){}_compile(t={}){this.compile(t),this.eventBus().emit(c.FLOW_RENDER,t)}compile(t={}){Object.assign(this.state,t);let e=this.parsedTemplate;e||(e=a(this.template()),this.parsedTemplate=e);const n=this.components(),s=this.getProps();this._virtDOM=this._virtDOM?this._virtDOM:new r,this._virtDOM.compile(e,this.state,s,this.deleteMark),this._virtDOM.getIsComponent().forEach((t=>{t.componentLink?t.componentLink.setProps(t.props):t.componentLink=new n[t.tagName](t.props),t.componentLink.deleteMark=t.deleteMark}))}_render(){this.render()}render(){this._virtDOM.getNodes().forEach((t=>{const e=t.parent&&t.parent.root?t.parent.root:this._root;if(t.isComponent)t.componentLink.init(e),t.root=t.componentLink.rootOut;else{if(t.element)t.deleteMark&&(t.element.remove(),t.element=null);else{if(t.deleteMark)return;t.element=document.createElement(t.tagName)}const n=t.element;t.changedProps.forEach((e=>{if("classes"===e)t.props.classes.forEach((t=>{n.classList.add(t)}));else if("function"==typeof t.props[e])e.startsWith("on")?n.addEventListener(e.slice(2).toLowerCase(),t.props[e]):n.setAttribute(e,t.props[e]);else if("href"===e){if(!t.props[e])return;t.props[e].startsWith("#{R}")&&n.addEventListener("click",l),n.setAttribute(e,t.props[e])}else"#noValue"===t.props[e]||n.setAttribute(e,t.props[e])})),t.changedProps=[],t.textContentIsChanged&&(n.textContent=t.textContent,t.textContentIsChanged=!1),t.isNew&&(e.appendChild(n),this._rootOut=n,t.root=n,n.setAttribute("uid",String(t.uid)))}t.isNew=!1}))}setState(t){var e;const n=window.copyObj(this.getProps());this.eventBus().emit(c.FLOW_CWU,this.getProps(),this.state),this.eventBus().emit(c.FLOW_EXECUTE,t),this.eventBus().emit(c.FLOW_CDU,n,this.getProps()),t&&(null===(e=this.virtDOM)||void 0===e||e.deleteMarkedNodes()),window.createValidateEvents()}};const d=class extends h{template(){return"<a className='anchor-main' id={{props.id}} rel='stylesheet' href={{props.href}} >{{props.text}}</a>"}};const u=class extends h{template(){return"<button \n        type='submit'\n        className='button-main'\n        id={{props.id}}\n        onClick={{props.onClick}}\n        href={{props.href}}\n      >\n        {{props.text}}\n      </button>"}};const p=class extends h{template(){return"<div className='bar__footer'></div>"}};const m=class extends h{template(){return"<div className='auth-bar-input'>\n        <label className='auth-bar-input__label' for={{props.id}}>{{props.text}}</label>\n        <input className='auth-bar-input__input' type={{props.type}} id={{props.id}} value={{props.value}}></input>\n      </div>"}};const _=class extends h{template(){return"<div className='bar__content'></div>"}};const g=class extends h{template(){return"<h3 className='bar__header'>{{props.text}}</h3>"}};const f=class extends h{template(){return"<form id='form__main' className='auth-bar-form'>\n      </form>"}};const v=class extends h{template(){return"<div className='page-column'>\n      </div>"}},C="https://ya-praktikum.tech/api/v2";var w;!function(t){t.GET="GET",t.POST="POST",t.PUT="PUT",t.DELETE="DELETE"}(w||(w={}));class k{constructor(){this.get=(t,e={})=>this.request(t,Object.assign(Object.assign({},e),{method:w.GET}),e.timeout),this.post=(t,e={})=>this.request(t,Object.assign(Object.assign({},e),{method:w.POST}),e.timeout),this.put=(t,e={})=>this.request(t,Object.assign(Object.assign({},e),{method:w.PUT}),e.timeout),this.DELETE=(t,e={})=>this.request(t,Object.assign(Object.assign({},e),{method:w.DELETE}),e.timeout),this.request=(t,e,n=5e3)=>{const{method:s,data:a,headers:i,withCredentials:o}=e;return t+=s===w.GET?window.queryStringify(a):"",new Promise(((e,r)=>{const l=new XMLHttpRequest;if(l.open(s,t),l.responseType="json",l.onload=function(){e(l)},l.timeout=n,l.onabort=r,l.onerror=r,l.ontimeout=r,i)for(let[t,e]of Object.entries(i))l.setRequestHeader(t,e);else l.setRequestHeader("content-type","application/json");o&&(l.withCredentials=o),s!==w.GET&&a?l.send(JSON.stringify(a)):l.send()}))}}}var b=function(t,e,n,s){return new(n||(n=Promise))((function(a,i){function o(t){try{l(s.next(t))}catch(t){i(t)}}function r(t){try{l(s.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,r)}l((s=s.apply(t,e||[])).next())}))};const y=(t=null)=>{console.error("xhrExecute:"+t)},M=(t="")=>{if(""===t)b(void 0,void 0,void 0,(function*(){try{const t=new k;return yield t.get(`${C}/auth/user`,{withCredentials:!0,headers:{"content-type":"application/json"}})}catch(t){y(t)}})).then((t=>{if(!t)throw"Something went wrong";if(401!==t.status){if(t.status>400)throw"Something went wrong";if(localStorage.setItem("id",t.response.id),localStorage.setItem("first_name",t.response.first_name),localStorage.setItem("second_name",t.response.second_name),localStorage.setItem("login",t.response.login),localStorage.setItem("email",t.response.email),localStorage.setItem("phone",t.response.phone),"#chat"===window.location.hash){(new e).renderPage(window.location.hash)}else window.location.hash="#chat"}else window.location.hash="#login"}),(t=>{y(t)}));else{(new e).renderPage(window.location.hash)}};var x=function(t,e,n,s){return new(n||(n=Promise))((function(a,i){function o(t){try{l(s.next(t))}catch(t){i(t)}}function r(t){try{l(s.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,r)}l((s=s.apply(t,e||[])).next())}))};class N extends h{constructor(){super(...arguments),this.state={loginOnClick:this.loginOnClick,login:localStorage.getItem("login")?localStorage.getItem("login"):"",password:""}}loginOnClick(t){return x(this,void 0,void 0,(function*(){t.preventDefault();const e=window.getFormData(),n={};for(const t in e.data)n[e.data[t].name]=e.data[t].value;let s=yield(a=n,b(void 0,void 0,void 0,(function*(){try{const t=new k;return yield t.post(`${C}/auth/signin`,{withCredentials:!0,headers:{"content-type":"application/json"},data:a})}catch(t){y(t)}})));var a;s&&(200===s.status?M():s.status>=400?alert(`Failed to execute sign in. reason ${s.response.reason}`):alert("Failed to execute sign in."))}))}components(){return{PageColumn:v,AuthBarForm:f,Bar__Header:g,Bar__Content:_,AuthBarInput:m,Bar__Footer:p,ButtonMain:u,AnchorMain:d}}template(){return"<PageColumn>\n        <AuthBarForm>\n          <Bar__Header text='Log in'></Bar__Header>\n          <Bar__Content>\n            <AuthBarInput text='login'    type='text'     id='input_login'    value={{state.login}}></AuthBarInput>                  \n            <AuthBarInput text='password' type='password' id='input_password' value={{state.password}}></AuthBarInput>                  \n          </Bar__Content>\n          <Bar__Footer>\n            <ButtonMain text='Log in' id='button_log-in' onClick={{state.loginOnClick}}></ButtonMain>\n            <AnchorMain text='Sign up' id='button_to-sign-up' href='#{R}#signup'></AnchorMain>\n          </Bar__Footer>\n        </AuthBarForm>\n      </PageColumn>"}}var B=function(t,e,n,s){return new(n||(n=Promise))((function(a,i){function o(t){try{l(s.next(t))}catch(t){i(t)}}function r(t){try{l(s.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,r)}l((s=s.apply(t,e||[])).next())}))};class E extends h{constructor(){super(...arguments),this.state={signUpOnClick:this.signUpOnClick,first_name:localStorage.getItem("first_name")?localStorage.getItem("first_name"):"",second_name:localStorage.getItem("second_name")?localStorage.getItem("second_name"):"",login:localStorage.getItem("login")?localStorage.getItem("login"):"",email:localStorage.getItem("email")?localStorage.getItem("email"):"",phone:localStorage.getItem("phone")?localStorage.getItem("phone"):"",password:""}}signUpOnClick(t){return B(this,void 0,void 0,(function*(){t.preventDefault();const e=window.getFormData(),n={};for(const t in e.data)n[e.data[t].name]=e.data[t].value;let s=yield(a=n,b(void 0,void 0,void 0,(function*(){try{const t=new k;return yield t.post(`${C}/auth/signup`,{data:a,withCredentials:!0,headers:{"content-type":"application/json"}})}catch(t){y(t)}})));var a;s?200===s.status?M():s.status>=400?alert(`Failed to execute sign up. reason ${s.response.reason}`):alert("Failed to execute sign up."):alert("Failed to execute sign up.")}))}components(){return{PageColumn:v,AuthBarForm:f,Bar__Header:g,Bar__Content:_,AuthBarInput:m,Bar__Footer:p,ButtonMain:u,AnchorMain:d}}template(){return"<PageColumn>\n        <AuthBarForm>\n          <Bar__Header text='Sign up'></Bar__Header>\n          \n          <Bar__Content>\n            <AuthBarInput text='First name'   type='name'     id='input_first-name'   value={{state.first_name}} ></>                  \n            <AuthBarInput text='Second name'  type='name'     id='input_second-name'  value={{state.second_name}} ></>                  \n            <AuthBarInput text='Login'        type='login'    id='input_login'        value={{state.login}} ></>                  \n            <AuthBarInput text='email'        type='mail'     id='input_email'        value={{state.email}} ></>                  \n            <AuthBarInput text='Password'     type='password' id='input_password'     value={{state.password}} ></>                  \n            <AuthBarInput text='Phone'        type='phone'    id='input_phone'        value={{state.phone}} ></>                  \n          </Bar__Content>\n          \n          <Bar__Footer>\n            <ButtonMain text='Sign up'      id='button-sign-up' onClick={{state.signUpOnClick}}></ButtonMain>\n            <AnchorMain text='Log in'  id='button-to-log-in' href='#{R}#login'></AnchorMain>\n          </Bar__Footer>\n        \n        </AuthBarForm>\n      </PageColumn>"}}class I extends h{components(){return{PageColumn:v}}template(){return"<PageColumn>\n        <h1>Messanger</h1>\n      </PageColumn>"}}const O=class extends h{template(){return"<div class='messages-bar'>\n        Please select a chat to start messaging \n      </div>"}};const P=class extends h{constructor(){super(...arguments),this.state={placeholder:this.getProps().placeholder?this.getProps().placeholder:"",type:this.getProps().type?this.getProps().type:"text",id:this.getProps().id?this.getProps().id:"input_search",title:this.getProps().title?this.getProps().title:"#title#",onChange:this.getProps().onChange?this.getProps().onChange:null}}template(){return"<div className='input-gray5'>\n        \n        {% if({{state.title}} !== '#title#') { %}\n          <label className='input-gray5__label' for={{state.id}}>{{state.title}}</label>\n        {% } %}  \n\n        //<div className='input-gray5__input-div>\n          <input \n            className='input-gray5__input' \n            type={{state.type}}\n            id={{state.id}} \n            placeholder={{state.placeholder}}\n            onChange={{state.onChange}}\n          >\n        //</div>     \n      </div>"}};const S=class extends h{components(){return{InputGray5:P}}template(){return"<form id='form__footer' className='messages-bar__footer'>\n        \n        <div className='footer__left'>\n          <button className='button-round bg-w' >\n            <i className='c-gy3 fas fa-paperclip'></i>\n          </button>\n        </div>       \n        \n        <div className='footer__middle'>\n          <InputGray5 type='text' id='input_send-message' placeholder='Write...'></InputGray5>\n        </div>\n  \n        <div className='footer__right'>\n          <button className='button-round bg-b1 margin5px' onClick={{props.sendMessage_onClik}}>\n            <i className='c-w fas fa-long-arrow-alt-right'></i>\n          </button>\n        </div>\n      \n      </form>"}};const A=class extends h{template(){return"<div className='message__free-space'>\n      </div>\n      <div className='message__outgoing'>\n        <div className='message__decor bg-gy5'>\n          {{props.text}}  \n          <span className='message__info'>\n            <i className='color-gray2 fas fa-check-double'></i>\n            {{props.date}}\n          </span>\n        </div>\n      </div>"}};const U=class extends h{template(){return"<div className='message__free-space'></div>"}};const T=class extends h{components(){return{Message__FreeSpace:U}}template(){return"<div className='message__incoming'>\n        <div className='message__decor bg-gy4'>\n          {{props.text}} \n        <span className='message__info'>\n          <i className='hide color-gray2 fas fa-check-double'></i>\n          {{props.date}} \n        </span>\n        </div>\n          \n        <Message__FreeSpace></Message__FreeSpace>\n        \n      </div>"}};const L=class extends h{components(){return{Message__Incoming:T,Message__Outgoing:A}}template(){return"<li className='message'>\n        {% if ({{props.type}} === 'in') { %}\n          <Message__Incoming\n            text={{props.text}}\n            date={{props.date}}\n          ></Message__Incoming>     \n        {% } else { %}\n          <Message__Outgoing\n            text={{props.text}}\n            date={{props.date}}\n          ></Message__Outgoing>     \n        {% } %} \n      </li>"}};const W=class extends h{components(){return{Message:L}}template(){return"<ul className='messages-bar__messages'>\n        {% for (let i = 0; i < props.messages.length; i++) { \n          const message = props.messages[i];\n        %}\n          <Message \n            key={{message.id}}\n            type={{message.type}}  \n            date={{message.date}}  \n            text={{message.text}}  \n          ></Message>\n        {% } %}\n      </ul>"}};const D=class extends h{template(){return"{% if({{props.avatar}} === null ) { %}\n          <div className='avatar-empty'>\n            <i className='c-gy3 fas fa-camera'></i>  \n          </div>\n        {% } else { %}\n          <div className='avatar'>\n            <img src={{props.avatar}}></img>\n          </div>\n      {% } %}"}};const F=class extends h{components(){return{Avatar:D}}template(){return"<div className='messages-bar__header' id={{props.id}}>\n        \n        <div className='header__avatar'>\n          <Avatar avatar={{props.avatar}}></Avatar>\n\n          // <div className='avatar-empty'>\n          //   <i className='c-gy3 fas fa-camera'></i>\n          // </div>\n        </div>\n        \n        <div className='header__content'>\n          <div className='header__username'>\n            <h1>{{props.title}}</h1>\n          </div>\n          <div className='header__last-seen'>\n            {{props.lastSeen}}\n          </div>\n        </div>\n        \n        <div className='header__menu'>\n          // <button className='button-vertical bg-w'>\n          //   <i className='fas fa-ellipsis-v'></i>\n          // </button>  \n        </div>\n      \n      </div>"}};class R{constructor(t,e,n){this.socket=null,this.onOpen=void 0,this.onClose=void 0,this.onMessage=void 0,this.onError=void 0,this.socket=new WebSocket(`wss://ya-praktikum.tech/ws/chats/${t}/${e}/${n}`),this.initEvents()}initEvents(){var t,e,n,s;null===(t=this.socket)||void 0===t||t.addEventListener("open",(()=>{console.log("Соединение установлено"),this.onOpen&&this.onOpen()})),null===(e=this.socket)||void 0===e||e.addEventListener("close",(t=>{t.wasClean?console.log("Соединение закрыто чисто"):console.log("Обрыв соединения"),console.log(`Код: ${t.code} | Причина: ${t.reason}`),this.onClose&&this.onClose(t)})),null===(n=this.socket)||void 0===n||n.addEventListener("message",(t=>{console.log("Получены данные",t.data),this.onMessage&&this.onMessage(t)})),null===(s=this.socket)||void 0===s||s.addEventListener("error",(t=>{console.log("Ошибка",t),this.onError&&this.onError(t)}))}send(t,e="message"){var n;null===(n=this.socket)||void 0===n||n.send(JSON.stringify({content:t,type:e}))}}const $=class extends h{constructor(){super(...arguments),this.chatid=0,this.token="",this.ws=null,this.avatar="",this.title="",this.userid="",this.messages=[],this.wsOnMessagesGetOld=t=>{const e=JSON.parse(t.data);this.messages=[];for(let t=0;t<e.length;t++){const n=e[t],s=(n.id&&n.id,String(n.user_id)===this.userid?"out":"in");this.messages.unshift({id:e.length-t,type:s,date:this.formatDate(n.time),text:n.content})}this.setState({messages:this.messages})},this.sendMessage_onClik=t=>{t.preventDefault(),t.stopImmediatePropagation();const e=document.getElementById("input_send-message"),n=e.value.trim();e.value="",n&&(this.ws=new R(String(localStorage.getItem("id")),String(this.chatid),this.token),this.ws.onMessage=this.wsOnMessagesSendMessages,this.ws.onOpen=()=>{var t;null===(t=this.ws)||void 0===t||t.send(n)})},this.wsOnMessagesSendMessages=t=>{this.updatePage(this.getProps())},this.state={sendMessage_onClik:this.sendMessage_onClik,messages:this.messages}}componentDidMount(t){this.updatePage(t)}componentDidUpdate(t,e){e.chatid!==this.chatid&&this.updatePage(e)}updatePage(t){this.chatid=t.chatid,this.avatar=t.avatar,this.title=t.title,this.token=t.token,this.userid=localStorage.getItem("id"),this.ws=new R(String(localStorage.getItem("id")),String(this.chatid),this.token),this.ws.onMessage=this.wsOnMessagesGetOld,this.ws.onOpen=()=>{var t;null===(t=this.ws)||void 0===t||t.send("0","get old")}}formatDate(t){return new Date(t).toLocaleString("ru",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"})}components(){return{MessagesBar__Header:F,MessagesBar__Messages:W,MessagesBar__Footer:S}}template(){return"<div className='messages-bar'>\n        <MessagesBar__Header title={{props.title}} id={{props.chatid}} avatar={{props.avatar}}></MessagesBar__Header>\n        <MessagesBar__Messages messages={{state.messages}}></MessagesBar__Messages> \n        <MessagesBar__Footer sendMessage_onClik={{state.sendMessage_onClik}}></MessagesBar__Footer>\n      </div>"}};const G=class extends h{template(){return"<button \n        type='submit'\n        className='button-secondary'\n        id={{props.id}}\n        onClick={{props.onClick}}\n        href={{props.href}}\n      >\n        {{props.text}}\n      </button>"}};const j=class extends h{constructor(){super(...arguments),this.onClose=t=>{t.preventDefault(),t.stopPropagation();const e=this.getProps();e.callback?e.callback():console.error("ModalWindow: callback function is undefined!")},this.onClick=t=>{t.preventDefault(),t.stopImmediatePropagation()},this.state={onClose:this.onClose,onClick:this.onClick}}template(){return"<div id='MW' className='MW' onClick={{state.onClick}}>\n        <div className='MW-dialog'>\n          <div className='MW-content'>\n            <div className='MW-header'>\n              <h4 className='MW-title'>{{props.title}}</h4>\n              <p className='MW_btn-close' onClick={{state.onClose}}>×</p>\n            </div>\n            <div className='MW-body'>    \n           \n            </div>\n          </div>\n        </div>\n      </div>"}};var H=function(t,e,n,s){return new(n||(n=Promise))((function(a,i){function o(t){try{l(s.next(t))}catch(t){i(t)}}function r(t){try{l(s.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,r)}l((s=s.apply(t,e||[])).next())}))};const X=class extends h{constructor(){super(...arguments),this.button_addChatOnClick=t=>H(this,void 0,void 0,(function*(){this.getProps().callback({title:document.getElementById("chat-title").value})})),this.onClose=()=>{this.getProps().callback()},this.state={onClose:this.onClose,button_addChatOnClick:this.button_addChatOnClick}}components(){return{MW:j,InputGray5:P,ButtonSecondary:G}}template(){return"{% if({{props.showAddChat}}) { %}\n        <MW title='Add chat' callback={{state.onClose}}>\n          <InputGray5 id='chat-title' title='Title'></InputGray5>\n          <div className='add-chat_buttons'> \n            <ButtonSecondary text='Add' id='button_add-chat' onClick={{state.button_addChatOnClick}}></ButtonSecondary>\n          </div>  \n        </MW>\n      {% } %}"}};const q=class extends h{constructor(){super(...arguments),this.li_onClick=t=>{t.preventDefault(),t.stopPropagation();let e=t.path.filter((t=>"LI"===t.nodeName));if(0===e.length)return;let n=e[0],s=null;n&&(s=n.getAttribute("id")),this.getProps().callback(s)},this.state={li_onClick:this.li_onClick}}components(){return{Avatar:D}}template(){return"<li \n        className='search-user__item' \n        id={{props.id}} \n        key={{props.key}} \n        onClick={{state.li_onClick}}\n      >\n        <div className='search-user__item-avatar'>\n          <Avatar avatar={{props.avatar}}></Avatar>\n        </div>\n        <div className='search-item__content'>\n          <p>{{props.login}}</p>\n        </div>\n      </li>"}};var V=function(t,e,n,s){return new(n||(n=Promise))((function(a,i){function o(t){try{l(s.next(t))}catch(t){i(t)}}function r(t){try{l(s.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,r)}l((s=s.apply(t,e||[])).next())}))};const z=class extends h{constructor(){super(...arguments),this.search_onChange=t=>V(this,void 0,void 0,(function*(){t.preventDefault(),t.stopPropagation(),yield this.getUsers(t.target.value)})),this.search_onClick=t=>{t.preventDefault(),t.stopPropagation()},this.onClose=()=>{this.state.users=[],this.getProps().callback()},this.item_callback=t=>{let e=null;for(let n=0;n<this.state.users.length;n++)if(String(this.state.users[n].id)===t){e=this.state.users[n];break}this.state.users=[],this.getProps().callback(e)},this.state={users:[],onClose:this.onClose,item_callback:this.item_callback,search_onChange:this.search_onChange}}getUsers(t=""){return V(this,void 0,void 0,(function*(){if(""===t)return this.state.users=[],void this.setState({users:[]});const e=yield(t=>b(void 0,void 0,void 0,(function*(){try{const e=new k;return yield e.post(`${C}/user/search`,{withCredentials:!0,headers:{"content-type":"application/json"},data:{login:t}})}catch(t){y(t)}})))(t);e&&(e.response.status>=400&&y(),this.setState({users:e.response}))}))}components(){return{MW:j,InputGray5:P,SearchUser__Item:q}}template(){return"{% if({{props.showSearchUsers}}) { %}\n        <MW title='Search users' callback={{state.onClose}}>\n\n          <InputGray5 onChange={{state.search_onChange}} id='input_search-users' ></InputGray5>\n          \n          <div className='MW__list'>\n            <ul className='users-list__list'>\n            \n              {% for (let i = 0; i < state.users.length; i++) { const chat = state.users[i]; %}\n                <SearchUser__Item \n                  id={{chat.id}} \n                  key={{chat.id}}\n                  avatar={{chat.avatar}} \n                  login={{chat.login}}\n                  callback={{state.item_callback}}\n                ></SearchUser__Item>\n              {% } %}\n            \n            </ul>\n          </div> \n        </MW>\n      {% } %}"}};const Q=class extends h{constructor(){super(...arguments),this.onClick=t=>{t.preventDefault();let e="";for(let n=0;n<t.path.length;n++)if("LI"===t.path[n].tagName){e=t.path[n].getAttribute("id");break}this.getProps().onClick({btnId:e,targetPath:this.targetPath})},this.state={buttons:this.getButtons(),onClick:this.onClick}}componentDidMount(){const t=this.getProps(),e=document.getElementById(t.ownerId),n=document.getElementById(t.menuId);(e||n)&&(null==e||e.addEventListener("contextmenu",(t=>{t.preventDefault(),n.style.top=`${t.clientY}px`,n.style.left=`${t.clientX}px`,n.classList.add("cm_active"),this.targetPath=t.path}),!1),n.addEventListener("click",(t=>{n.classList.remove("cm_active"),t.stopPropagation()}),!1))}getButtons(){const t=this.getProps().blockButtons?this.getProps().blockButtons.split("|"):[],e=[],n=this.getIconclassName;return this.getProps().buttons.split("|").forEach((function(s){const a=s.split(":"),i=t.includes(a[0]);e.push({id:a[0],type:a[1],text:a[2],block:t.includes(a[0]),li_className:"cm__cm-element",i_className:n(a[1],i),p_className:i?"cm-block":""})})),e}getIconclassName(t,e){let n="";switch(t){case"add":n="fas fa-plus-circle c-gn1";break;case"remove":n="fas fa-minus-circle c-r1";break;default:n="fas fa-circle cm-icon_hide"}return n.concat(" cm-icon").concat(e?" cm-block":"")}template(){return"<ul className='cm' id={{props.menuId}}>\n        {% for (let i = 0; i < state.buttons.length; i++) { \n          const button = state.buttons[i];\n        %}\n          <li \n            className={{button.li_className}}\n            id={{button.id}}\n            key={{button.id}}\n            onClick={{state.onClick}}\n          >\n            <i className={{button.i_className}}></i>\n            <p className={{button.p_className}}>{{button.text}}</p>  \n\n          </li> \n        {% } %}\n      </ul>"}};const Z=class extends h{constructor(){super(...arguments),this.state={onRouteClick:l}}components(){return{Avatar:D}}template(){return"<li className='chats-list__chat-item' id={{props.id}} key={{props.key}}>\n        <div className='chat-item__avatar'>\n          <Avatar avatar={{props.avatar}}></Avatar>\n        </div>\n        <div className='chat-item__content'>\n          <div className='chat-item__content-top'>\n            <h4 className='chat-item__chatname'>{{props.name}}</h4>\n            //<div className='chat-item__last-message-time'>\n              //<span className='last-message-time__value'>{{props.lastMessageDate}}</span>\n            //</div>\n          </div>    \n          <div className='chat-item__content-bottom'>\n            //<div className='chat-item__last-message'>\n            //   {% if (props.lastMessageType === 'out') { %}\n            //     <b>You:</b>\n            //   {% } %}\n            //   <div className='last-message__value'>{{props.lastMessageText}}</div>\n            //  <div className='last-message__value'>test</div>\n            //</div>\n            // {% if (props.countUnread > 0) { %}\n            //   <div className='chat-item__count-message'>\n            //     <a className='count-message__value'>{{props.countUnread}}</a>\n            //   </div>\n            // {% } %}\n          </div>    \n        </div>\n      </li>"}};var J=function(t,e,n,s){return new(n||(n=Promise))((function(a,i){function o(t){try{l(s.next(t))}catch(t){i(t)}}function r(t){try{l(s.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,r)}l((s=s.apply(t,e||[])).next())}))};const K=class extends h{constructor(){super(...arguments),this.currentChatId=0,this.chatsOnClick=t=>{t.preventDefault();let e=t.path.filter((t=>"LI"===t.nodeName));if(0===e.length)return;let n=e[0],s=null;if(n&&(s=n.getAttribute("id")),this.currentChatId=Number(s),null!==s){const t=this.state.chats.filter((t=>String(t.id)===s));t.length>0&&this.getProps().callback({chat:t[0]})}},this.CM_onClick=t=>{"addUser"===t.btnId?this.addUser_event(t):"removeUser"===t.btnId?this.removeUser_event(t):"addChat"===t.btnId?this.addChat_event(t):"removeChat"===t.btnId&&this.removeChat_event(t)},this.addUser_event=t=>J(this,void 0,void 0,(function*(){this.setState({showSearchUsers:!0})})),this.removeUser_event=t=>{},this.searchUsers_callback=t=>J(this,void 0,void 0,(function*(){if(this.setState({showSearchUsers:!1}),!t)return;yield(e={chatId:this.currentChatId,users:[t.id]},b(void 0,void 0,void 0,(function*(){try{const t=new k;return yield t.put(`${C}/chats/users`,{withCredentials:!0,headers:{"content-type":"application/json"},data:e})}catch(t){y(t)}})));var e})),this.addChat_event=t=>J(this,void 0,void 0,(function*(){this.setState({showAddChat:!0})})),this.removeChat_event=t=>{},this.addChat_callback=t=>J(this,void 0,void 0,(function*(){if(this.setState({showAddChat:!1}),!t)return;const e=yield(t=>b(void 0,void 0,void 0,(function*(){try{const e=new k;return yield e.post(`${C}/chats`,{withCredentials:!0,headers:{"content-type":"application/json"},data:t})}catch(t){y(t)}})))(t);e&&e.status>=400?alert(`Failed to create chat: ${e.response.error}, ${e.response.reason}`):this.setState({chats:yield this.getChats()})})),this.chatsOnСontextMenu=t=>{t.preventDefault();let e=t.path.filter((t=>"LI"===t.nodeName));if(0===e.length)return;let n=e[0],s=null;n&&(s=n.getAttribute("id")),this.currentChatId=Number(s)},this.state={CM_onClick:this.CM_onClick,chatsOnClick:this.chatsOnClick,chatsOnСontextMenu:this.chatsOnСontextMenu,showSearchUsers:!1,searchUsers_callback:this.searchUsers_callback,showAddChat:!1,addChat_callback:this.addChat_callback}}componentDidMount(t,e){return J(this,void 0,void 0,(function*(){this.setState({chats:yield this.getChats()})}))}getChats(){return J(this,void 0,void 0,(function*(){const t=yield b(void 0,void 0,void 0,(function*(){try{const t=new k;return yield t.get(`${C}/chats`,{withCredentials:!0,headers:{"content-type":"application/json"}})}catch(t){y(t)}}));if(t)return t.response.status>=400&&y(),t.response}))}components(){return{ChatsList__ChatItem:Z,ContextMenu:Q,MW__SearchUser:z,MW__AddChat:X}}template(){return"\n      <div \n        className='chats-bar__chats-list' \n        onClick={{state.chatsOnClick}} \n        oncontextmenu={{state.chatsOnСontextMenu}} \n        id='chats-list'\n      >\n\n        <ul className='chats-list__list'>\n          \n          {% for (let i = 0; i < state.chats.length; i++) { const chat = state.chats[i]; %}\n            <ChatsList__ChatItem \n              id={{chat.id}}\n              key={{chat.id}}\n              name={{chat.title}}\n              avatar={{chat.avatar}}\n              //markId={{}}\n              // lastMessageType={{chat.lastMessage.type}}\n              // lastMessageDate={{chat.lastMessage.date}}\n              // lastMessageText={{chat.lastMessage.text}}\n              // countUnread={{chat.countUnread}}\n            ></ChatsList__ChatItem>\n          {% } %}\n        </ul>\n\n      </div>\n\n      <ContextMenu \n        buttons='addChat:add:Add chat|removeChat:remove:Remove chat|addUser:add:Add user|removeUser:remove:Remove user'\n        //blockButtons='addChat|removeChat'\n        onClick={{state.CM_onClick}}\n        ownerId='chats-list'\n        menuId='chats-list-context-menu'\n      ></ContextMenu>\n  \n      <MW__SearchUser showSearchUsers={{state.showSearchUsers}} callback={{state.searchUsers_callback}}></MW__SearchUser>\n      <MW__AddChat showAddChat={{state.showAddChat}} callback={{state.addChat_callback}}></MW__AddChat>\n      "}};const Y=class extends h{template(){return"<a className='anchor-to-go' id='button-to-profile' rel='stylesheet' href={{props.href}}>\n        <p className='anchor-to-go_p'>{{props.text}}</p>\n        <i className='anchor-to-go_icon fas fa-caret-right'></i>\n      </a>"}};const tt=class extends h{constructor(){super(...arguments),this.list_callback=t=>{this.getProps().callback(t)},this.state={list_callback:this.list_callback}}components(){return{AnchorToGo:Y,InputGray5:P,ChatsBar__ChatsList:K}}template(){return"<div className='chats-bar'>\n        <form id='form__header' className='chats-bar__header'>\n          <AnchorToGo text='Profile' href='#{R}#userSettings'></AnchorToGo>\n          <InputGray5></InputGray5>\n        </form>\n        <ChatsBar__ChatsList callback={{state.list_callback}}></ChatsBar__ChatsList>\n      </div>"}};var et=function(t,e,n,s){return new(n||(n=Promise))((function(a,i){function o(t){try{l(s.next(t))}catch(t){i(t)}}function r(t){try{l(s.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,r)}l((s=s.apply(t,e||[])).next())}))};class nt extends h{constructor(){super(...arguments),this.chatid=0,this.token="",this.ws=null,this.avatar="",this.title="",this.chatsBar_callback=t=>et(this,void 0,void 0,(function*(){if(t.chat){if(this.chatid===t.chat.id)return;this.chatid=t.chat.id,this.avatar=t.chat.avatar,this.title=t.chat.title,this.setState({showMessages:!0,shatid:String(this.chatid),chatid:this.chatid,avatar:this.avatar,title:this.title,token:this.token})}})),this.state={chatsBar_callback:this.chatsBar_callback,showMessages:!1}}componentDidUpdate(){window.createValidateEvents()}components(){return{ChatsBar:tt,MessagesBar:$,MessagesBarSelect:O}}template(){return"<div className='page-chat'>\n        <ChatsBar callback={{state.chatsBar_callback}}></ChatsBar>\n        {% if({{state.showMessages}}) { %}\n          <MessagesBar \n            chatid={{state.chatid}} \n            token={{state.token}} \n            avatar={{state.avatar}} \n            title={{state.title}} \n            sendMesageOnClick_callback={{state.sendMesageOnClick_callback}}\n          ></MessagesBar>\n        {% } else { %}\n          <MessagesBarSelect></MessagesBarSelect>\n        {% } %}\n      </div>"}}const st=class extends h{template(){return"<div className='user-settings-bar-input'>\n        <label className='user-settings-bar-input__label' for='user-settings-bar-input__input'>{{props.text}}</label>\n        <input className='user-settings-bar-input__input' type={{props.type}} id={{props.id}} value={{props.value}}>\n      </div>"}};const at=class extends h{template(){return"<form id='form__main' className='user-settings-bar'></div>"}};var it=function(t,e,n,s){return new(n||(n=Promise))((function(a,i){function o(t){try{l(s.next(t))}catch(t){i(t)}}function r(t){try{l(s.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,r)}l((s=s.apply(t,e||[])).next())}))};class ot extends h{constructor(){super(...arguments),this.state={logoutOnClick:this.logoutOnClick,first_name:localStorage.getItem("first_name")?localStorage.getItem("first_name"):"",second_name:localStorage.getItem("second_name")?localStorage.getItem("second_name"):"",login:localStorage.getItem("login")?localStorage.getItem("login"):"",email:localStorage.getItem("email")?localStorage.getItem("email"):"",phone:localStorage.getItem("phone")?localStorage.getItem("phone"):"",oldPassword:"",newPassword:""}}logoutOnClick(t){return it(this,void 0,void 0,(function*(){t.preventDefault();let e=yield b(void 0,void 0,void 0,(function*(){try{const t=new k;return yield t.post(`${C}/auth/logout`,{withCredentials:!0,headers:{"content-type":"application/json"}})}catch(t){y(t)}}));e?200===e.status&&M():alert("Failed to execute log out")}))}components(){return{PageColumn:v,UserSettingsBar:at,Bar__Header:g,Bar__Content:_,UserSettingsBarInput:st,Bar__Footer:p,ButtonMain:u,ButtonSecondary:G}}template(){return"<PageColumn>\n        <UserSettingsBar>\n          \n          <Bar__Header text='User settings'></Bar__Header>\n          \n          <Bar__Content>\n            <UserSettingsBarInput text='First name'       type='text'       id='input_first-name'   value={{state.first_name}} ></>                  \n            <UserSettingsBarInput text='Second name'      type='text'       id='input_second-name'  value={{state.second_name}}  ></>                  \n            <UserSettingsBarInput text='Login'            type='text'       id='input_login'        value={{state.login}}  ></>                  \n            <UserSettingsBarInput text='Email'            type='email'      id='input_email'        value={{state.email}}  ></>                  \n            <UserSettingsBarInput text='Phone'            type='tel'        id='input_phone'        value={{state.phone}}  ></>                  \n            <UserSettingsBarInput text='Old password'     type='password'   id='input_old-password' value={{state.oldPassword}}  ></>                  \n            <UserSettingsBarInput text='New password'     type='password'   id='input_new-password' value={{state.newPassword}}  ></>                  \n          </Bar__Content>\n          \n          <Bar__Footer>\n            <ButtonMain text='Save' id='button_save'></ButtonMain>\n            <ButtonSecondary text='Log out' id='button_log-out' onClick={{state.logoutOnClick}}></ButtonSecondary>\n          </Bar__Footer>\n        \n        </UserSettingsBar>\n      </PageColumn>"}}const rt=class extends h{components(){return{PageColumn:v,AnchorMain:d}}template(){return"<PageColumn>\n        <div class='error-bar'>\n          <h1>{{props.errCode}}</h1>\n          <div>{{props.message}}</div>\n          <AnchorMain \n            text='Back to chats'  \n            id='button_back-to-chats'\n            href={{props.href}}\n          </AnchorMain>\n        </div>\n      </PageColumn>"}};class lt extends h{components(){return{ErrorBar:rt}}template(){return"<ErrorBar \n        errCode='404'\n        message='Wrong way'\n        href='#{R}#chat'\n      ></>"}}class ct extends h{components(){return{ErrorBar:rt}}template(){return"<ErrorBar\n        errCode='500'\n        message='Sorry, something is wrong'\n        href='#{R}#chat'\n      ></>"}}class ht extends h{constructor(){super(...arguments),this.CM_onClick=t=>{this.setState({btnTestUpdate_text:"Success!",btnTestUpdate_id:"newId"});const e=this.state.list;"add"===t.btnId?e.push({a:7,b:"8"}):e.pop(),this.setState({btnTestUpdate_text:"ContextMwnu",list:e})},this.btnTestUpdate_onClick=()=>{"Success"===this.state.btnTestUpdate_text?this.setState({btnTestUpdate_text:"TestUpdate"}):this.setState({btnTestUpdate_text:"Success"})},this.btnTestCycle_onClick=()=>{3===this.state.list.length?this.state.list.push({a:11,b:"12"}):this.state.list.pop(),this.setState({list:this.state.list})},this.btnTestCycleItemUpdate_onClick=()=>{"4"===this.state.list[1].b?this.state.list[1]={a:3,b:"444444"}:this.state.list[1]={a:3,b:"4"},this.setState({list:this.state.list})},this.btnTestIf_onClick=()=>{null!==this.state.condition?this.setState({condition:null}):this.setState({condition:!0})},this.state={CM_onClick:this.CM_onClick,btnTestUpdate_onClick:this.btnTestUpdate_onClick,btnTestUpdate_id:"button_log-in",btnTestUpdate_text:"TestUpdate",condition:!0,conditionR:null,btnTestIf_onClick:this.btnTestIf_onClick,btnTestCycle_onClick:this.btnTestCycle_onClick,list:[{a:1,b:"2"},{a:3,b:"4"},{a:5,b:"6"}],btnTestCycleItemUpdate_onClick:this.btnTestCycleItemUpdate_onClick}}components(){return{ButtonMain:u,PageColumn:v,AuthBarInput:m,AnchorMain:d,ContextMenu:Q}}template(){return"<div className='right-click-area' id='CM_OwnerId' >\n        \n      // <ButtonMain text={{state.btnTestUpdate_text}} id={{state.btnTestUpdate_id}} onClick={{state.btnTestUpdate_onClick}} ></ButtonMain>\n      <ButtonMain text='test if' id='test-if' onClick={{state.btnTestIf_onClick}} ></ButtonMain>\n      // <ButtonMain text='test cycle' id='test-cycle' onClick={{state.btnTestCycle_onClick}} ></ButtonMain>\n      // <ButtonMain text='test cycle item update' id='test-cycle_item_update' onClick={{state.btnTestCycleItemUpdate_onClick}} ></ButtonMain>\n      \n      {% if({{state.condition}} === null ) { %}\n        <PageColumn>\n      \n          <ul className='list-test'>\n          {% for (let    i   =    0; i < state.list.length; i++) { \n            const listEl = state.list[i];\n          %}\n        \n            <li key={{listEl.a}}>\n              <AuthBarInput key={{listEl.a}} id={{listEl.a}} text={{listEl.b}}    type='text'     value='{{listEl.b}}></AuthBarInput> \n              <a key={{listEl.a}} id={{listEl.a}}>{{listEl.b}}</a> \n              <AnchorMain key={{listEl.a}} id={{listEl.a}} text={{listEl.b}} href='#{R}#signup'></AnchorMain>\n            </li>\n        \n          {% } %}\n          </ul>\n      \n      \n          <AuthBarInput text='true'    type='text'     id='true'    value='true'></AuthBarInput> \n          <a>99+</a> \n        </PageColumn>\n      \n      {% } else { %}\n        <PageColumn>\n          <AuthBarInput text='false'    type='text'     id='input_login'    value='false'></AuthBarInput> \n          <a>000</a> \n          <AnchorMain text='Test if' id='button_to-sign-up' href='#{R}#signup'></AnchorMain>\n        </PageColumn>\n      {% } %}\n      \n\n        // <ContextMenu \n        //   buttons='add:add|remove:Remove chat'\n        //   onClick={{state.CM_onClick}}\n        //   ownerId='CM_OwnerId'\n        //   menuId='CM_MenuId'\n        // ></ContextMenu>\n              \n\n      </div>"}}const dt=(t,e,n)=>{const s=e.split(".");let a=t;for(let t of s)if(a=a[t],void 0===a)return n;return null===a?null:null!=a?a:n},ut=(t,e)=>{if(null===t)return null===e;if(Object.keys(t).length!==Object.keys(e).length)return!1;let n=!0;for(const s in t){if(Array.isArray(t[s])){if(!Array.isArray(e[s]))return!1;if(t[s].lenght!==e[s].lenght)return!1;for(let a=0;a<t[s].lenght;a++)if(n=ut(t[s][a],e[s][a]),!n)return n}if("object"==typeof t[s]){if(n=ut(t[s],e[s]),!n)return n}else if(t[s]!==e[s])return!1}return n},pt=t=>0!==(t=t.trim()).length&&t[0]===t[0].toUpperCase();const mt=function(){let t=0;return function(){return t++,t}}(),_t=(t,e)=>{let n=null;const s=[];for(;n=e.exec(t);)s.push(n);return s},gt=t=>{if(!t)return"";let e="";for(let[n,s]of Object.entries(t))e+=`&${n}=${s}`;return e&&(e="?"+e.substr(1)),e},ft=t=>{let e={};for(const n in t)"function"==typeof t[n]?e[n]=t[n]:Array.isArray(t[n])?(e[n]=[],t[n].forEach((t=>{e[n].push(ft(t))}))):e[n]=t[n];return e};function vt(t,e){let n=!0;switch(t){case"text":n=function(t){return t.length>0}(e);break;case"login":n=function(t){return/^[a-zA-Z\-\_]+$/.test(t)}(e);break;case"name":n=function(t){return/^[a-zA-Z\s]+$/.test(t)}(e);break;case"mail":n=function(t){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)}(e);break;case"phone":n=function(t){return/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im.test(t)}(e);break;case"password":n=function(t){return/^(?=.*[\d])(?=.*[A-Z])(?=.*[a-z])(?=.*[!@#$%^&*])[\w!@#$%^&*]{4,}$/.test(t)}(e)}return n}const Ct=()=>{let t=!0,e=[];for(let s of document.forms)for(let a of s.getElementsByTagName("input")){const s=a.getAttribute("type"),i=vt(s,a.value);t=t&&i,e.push({name:(n=a.id,n.slice(6).replace("-","_")),type:s,value:a.value,valid:i})}var n;return{valid:t,data:e}};function wt(){for(let t of document.forms){t.addEventListener("submit",(t=>{kt(t)}));for(let e of t.getElementsByTagName("input"))e.addEventListener("focus",(t=>{yt(t)})),e.addEventListener("blur",(t=>{bt(t)}))}}function kt(t){t.preventDefault()}function bt(t){t.preventDefault()}function yt(t){t.preventDefault()}window.startsWithUpper=pt,window.get=dt,window.uid=mt,window.getFormData=Ct,window.createValidateEvents=wt,window.isEqual=ut,window.regexpMatchAll=_t,window.queryStringify=gt,window.copyObj=ft,new e(".app").use("/",I).use("#login",N).use("#signup",E).use("#chat",nt).use("#error404",lt).use("#error500",ct).use("#userSettings",ot).use("#testPage",ht).start(),document.addEventListener("click",(t=>{2!==t.button&&document.querySelectorAll(".cm").forEach((function(t){t.classList.remove("cm_active")}))}),!1),M(window.location.hash)})();